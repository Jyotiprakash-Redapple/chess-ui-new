(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[409],{8667:function(e,t,n){"use strict";n.d(t,{$j:function(){return l},Ee:function(){return C},HE:function(){return h},J$:function(){return v},K1:function(){return k},Kt:function(){return f},Mt:function(){return E},Qc:function(){return i},Qi:function(){return A},Qu:function(){return d},UG:function(){return u},WE:function(){return y},YH:function(){return a},ib:function(){return p},p$:function(){return g},tq:function(){return c},ut:function(){return o},wN:function(){return b},wc:function(){return s}});var r=n(3644);let i=e=>{let{newPosition:t,newMove:n}=e;return{type:r.Hp.NEW_MOVE,payload:{newPosition:t,newMove:n}}},o=e=>{let{pieces_square_info:t}=e;return{type:r.Hp.PIECES_SQOURE_INFO,payload:{pieces_square_info:t}}},l=e=>{let{candicateMove:t}=e;return{type:r.Hp.CANDIDATE_MOVE,payload:{candicateMove:t}}},u=()=>({type:r.Hp.CLEAR_CANDIDATE_MOVES,payload:[]}),s=()=>({type:r.Hp.CLEAR_PIECES_SQOURE_INFO,payload:""}),a=e=>{let{rank:t,file:n,x:i,y:o}=e;return{type:r.Hp.OPEN_PROMOTION_BOX,payload:{rank:t,file:n,x:i,y:o}}},c=e=>({type:r.Hp.CHECK_CASTEL,payload:e}),p=()=>({type:r.Hp.DECTACT_STALEMET}),h=()=>({type:r.Hp.DECTACT_INSUFFICIANT_MATARIAL}),d=e=>({type:r.Hp.WIN,payload:e}),f=e=>{let{prevPosition:t,x:n,y:i}=e;return{type:r.Hp.SAVE_KILL_PICES,payload:{prevPosition:t,x:n,y:i}}},v=e=>{let{socket:t}=e;return{type:r.Hp.NEW_SOCKET_CONNECTION,payload:{socket:t}}},y=e=>{let{arg:t}=e;return{type:r.Hp.NEW_GAME_INIT,payload:{arg:t}}},b=e=>{let{arg:t}=e;return{type:r.Hp.BOARD_UPDATE,payload:{arg:t}}},k=e=>({type:r.Hp.UPDATE_ADVANTAGE,payload:e}),E=e=>({type:r.Hp.GAME_TIME,payload:e}),A=e=>({type:r.Hp.TURN_TIME,payload:e}),g=e=>({type:r.Hp.UPDATE_TURN,payload:e}),C=e=>({type:r.Hp.GAME_END,payload:e})},7409:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return _}});var r=n(7437),i=n(2265);n(6605);var o=n(5549),l=n(3644),u=n(2711);let s=e=>{let{position:t,rank:n,file:r,piece:i}=e,o=[],l=i[0],u="w"===l?"b":"w";return[[-1,0],[0,1],[0,-1],[1,0]].forEach(e=>{for(let s=1;s<8;s++){var i;let a=s*e[0],c=s*e[1],p=n+a,h=r+c;if((null==t?void 0:null===(i=t[p])||void 0===i?void 0:i[h])===void 0)return;let d=t[p][h],f=d.startsWith(u),v=d.startsWith(l);if(f){o.push([p,h]);return}if(v)return;o.push([p,h])}}),o},a=e=>{let{position:t,rank:n,file:r}=e,i=[],o=t[n][r].startsWith("w")?"b":"w";return[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].forEach(e=>{var l;let u=null==t?void 0:null===(l=t[n+e[0]])||void 0===l?void 0:l[r+e[1]];void 0!==u&&(u.startsWith(o)||""===u)&&i.push([n+e[0],r+e[1]])}),i},c=e=>{let{position:t,piece:n,rank:r,file:i}=e,o=[],l=n[0],u="w"===l?"b":"w";return[[-1,-1],[-1,1],[1,-1],[1,1]].forEach(e=>{for(let s=1;s<=8;s++){var n;let a=r+s*e[0],c=i+s*e[1];if((null==t?void 0:null===(n=t[a])||void 0===n?void 0:n[c])===void 0)break;if(t[a][c].startsWith(u)){o.push([a,c]);break}if(t[a][c].startsWith(l))break;o.push([a,c])}}),o},p=e=>{let{position:t,piece:n,rank:r,file:i}=e,o=[...c({position:t,piece:n,rank:r,file:i}),...s({position:t,piece:n,rank:r,file:i})];return o},h=e=>{let{position:t,piece:n,rank:r,file:i}=e,o=[],l=n[0];return[[1,-1],[1,0],[1,1],[0,-1],[0,1],[-1,-1],[-1,0],[-1,1]].forEach(e=>{var n;let u=r+e[0],s=i+e[1];(null==t?void 0:null===(n=t[u])||void 0===n?void 0:n[s])===void 0||t[u][s].startsWith(l)||o.push([u,s])}),o},d=e=>{var t,n,r;let{position:i,piece:o,rank:l,file:u,opponent:s}=e,a=[],c="wp"===o?1:-1;return l%5==1&&(null==i?void 0:null===(n=i[l+c])||void 0===n?void 0:n[u])===""&&(null==i?void 0:null===(r=i[l+c+c])||void 0===r?void 0:r[u])===""&&a.push([l+c+c,u]),(null==i?void 0:null===(t=i[l+c])||void 0===t?void 0:t[u])||a.push([l+c,u]),a},f=e=>{var t,n;let{position:r,prevPosition:i,piece:o,rank:l,file:u}=e,s=[],a="wp"===o?1:-1,c="w"===o[0]?"b":"w";(null==r?void 0:null===(t=r[l+a])||void 0===t?void 0:t[u-1])&&r[l+a][u-1].startsWith(c)&&s.push([l+a,u-1]),(null==r?void 0:null===(n=r[l+a])||void 0===n?void 0:n[u+1])&&r[l+a][u+1].startsWith(c)&&s.push([l+a,u+1]);let p=1===a?"bp":"wp";return i&&(1===a&&4===l||-1===a&&3===l)&&[u-1,u+1].forEach(e=>{var t,n,o,u;(null==r?void 0:null===(t=r[l])||void 0===t?void 0:t[e])===p&&(null==r?void 0:null===(n=r[l+a+a])||void 0===n?void 0:n[e])===""&&(null==i?void 0:null===(o=i[l])||void 0===o?void 0:o[e])===""&&(null==i?void 0:null===(u=i[l+a+a])||void 0===u?void 0:u[e])===p&&s.push([l+a,e])}),s},v=e=>{let{position:t,castelDirection:n,piece:r,rank:i,file:o}=e,l=[];if(4!==o||i%7!=0||"none"===n)return l;if(r.startsWith("w")){if(C.isPlayerChecked({positionAfterMove:t,player:"w"}))return l;!["left","both"].includes(n)||t[0][3]||t[0][1]||t[0][2]||"wr"!==t[0][0]||C.isPlayerChecked({positionAfterMove:C.checkAmove({position:t,piece:r,rank:i,file:o,x:0,y:3}),player:"w"})||C.isPlayerChecked({positionAfterMove:C.checkAmove({position:t,piece:r,rank:i,file:o,x:0,y:2}),player:"w"})||l.push([0,2]),!["right","both"].includes(n)||t[0][5]||t[0][6]||"wr"!==t[0][7]||C.isPlayerChecked({positionAfterMove:C.checkAmove({position:t,piece:r,rank:i,file:o,x:0,y:5}),player:"w"})||C.isPlayerChecked({positionAfterMove:C.checkAmove({position:t,piece:r,rank:i,file:o,x:0,y:6}),player:"w"})||l.push([0,6])}else{if(C.isPlayerChecked({positionAfterMove:t,player:"b"}))return l;!["left","both"].includes(n)||t[7][3]||t[7][1]||t[7][2]||"br"!==t[7][0]||C.isPlayerChecked({positionAfterMove:C.checkAmove({position:t,piece:r,rank:i,file:o,x:7,y:3}),player:"b"})||C.isPlayerChecked({positionAfterMove:C.checkAmove({position:t,piece:r,rank:i,file:o,x:7,y:2}),player:"b"})||l.push([7,2]),!["right","both"].includes(n)||t[7][5]||t[7][6]||"br"!==t[7][7]||C.isPlayerChecked({positionAfterMove:C.checkAmove({position:t,piece:r,rank:i,file:o,x:7,y:5}),player:"b"})||C.isPlayerChecked({positionAfterMove:C.checkAmove({position:t,piece:r,rank:i,file:o,x:7,y:6}),player:"b"})||l.push([7,6])}return l},y=e=>{let{castelDirection:t,piece:n,rank:r,file:i}=e;i=Number(i),r=Number(r);let o=t[n[0]];if(n.endsWith("k"))return"none";if(0===i&&0===r){if("both"===o)return"right";if("left"===o)return"none"}if(7===i&&0===r){if("both"===o)return"left";if("right"===o)return"none"}if(0===i&&7===r){if("both"===o)return"right";if("left"===o)return"none"}if(7===i&&7===r){if("both"===o)return"left";if("right"===o)return"none"}},b=(e,t)=>{let n=[];return e&&e.length>0&&e.forEach((r,i)=>{r.forEach((r,o)=>{e[i][o].startsWith(t)&&n.push({piece:e[i][o],rank:i,file:o})})}),n},k=(e,t)=>{let n=[];return e&&e.length>0&&e.forEach((r,i)=>{r.forEach((r,o)=>{e[i][o].startsWith(t)&&e[i][o].endsWith("k")&&(n=[i,o])})}),n},E=e=>{let{status:t,piece:n,prevSum:r,opponentColor:i,moveColor:o,from_:s,to_:a,x:c,y:p,prevPosition:h,promotion:d,newMove:f}=e;if(t===l.XN.white||t===l.XN.black)return o===i?1e10:-1e10;if(t===l.XN.insufficiant||t===l.XN.stalemet)return 0;(t===l.XN.b_check||t===l.XN.w_check)&&(o===i?r+=50:r-=50);var v=[8-parseInt(s[1]),s.charCodeAt(0)-97],y=[8-parseInt(a[1]),a.charCodeAt(0)-97];if(r<-1500&&"k"===n&&(n="k_e"),f.includes("x")){let e=h[c][p]||null;console.log(e,"capture picves"),e&&(o===i?r+=u.Xz[e[1]]+u.MS[i][e[1]][y[0]][y[1]]:r-=u.Xz[e[1]]+u.PI[i][e[1]][y[0]][y[1]])}return"p"===n?d&&(i===o?(r-=u.Xz[n]+u.PI[o][n][v[0]][v[1]],r+=u.Xz[d]+u.PI[o][d][y[0]][y[1]]):(r+=u.Xz[n]+u.PI[o][n][v[0]][v[1]],r-=u.Xz[d]+u.PI[o][d][y[0]][y[1]])):o!==i?(r+=u.PI[o][n][v[0]][v[1]],r-=u.PI[o][n][y[0]][y[1]]):(r-=u.PI[o][n][v[0]][v[1]],r+=u.PI[o][n][y[0]][y[1]]),r},A=e=>{let{position:t,piece:n,rank:r,file:i,x:o,y:l}=e,s=(0,u.rP)(t);return s[o][l]||o===r||l===i||(s[r][l]=""),s[Number(r)][Number(i)]="",s[o][l]=n,s},g=e=>{let{position:t,piece:n,rank:r,file:i,x:o,y:l}=e,s=(0,u.rP)(t),a=n.endsWith("k");if(a&&Math.abs(l-i)>1){let e=n.startsWith("w");2==l&&(s[r][0]="",s[r][3]=e?"wr":"br"),6==l&&(s[r][7]="",s[r][5]=e?"wr":"br")}return s[Number(r)][Number(i)]="",s[o][l]=n,s},C={getRegularMove:function(e){let{position:t,rank:n,file:r,piece:i}=e;return i.endsWith("n")?a({position:t,rank:n,file:r}):i.endsWith("b")?c({position:t,piece:i,rank:n,file:r}):i.endsWith("r")?s({position:t,piece:i,rank:n,file:r}):i.endsWith("q")?p({position:t,piece:i,rank:n,file:r}):i.endsWith("k")?h({position:t,piece:i,rank:n,file:r}):i.endsWith("p")?[...d({position:t,piece:i,rank:n,file:r})]:void 0},getValidMoves:function(e){let{position:t,castelDirection:n,prevPosition:r,piece:i,rank:o,file:l}=e,u=this.getRegularMove({position:t,piece:i,rank:o,file:l}),s=[];return i.endsWith("p")&&(u=[...u,...f({position:t,prevPosition:r,piece:i,rank:o,file:l})]),i.endsWith("k")&&(u=[...u,...v({position:t,castelDirection:n,piece:i,rank:o,file:l})]),u.forEach(e=>{let[n,r]=e,u=this.checkAmove({position:t,piece:i,rank:o,file:l,x:n,y:r});this.isPlayerChecked({positionAfterMove:u,position:t,player:i[0]})||s.push([n,r])}),s},checkAmove:function(e){let{position:t,piece:n,rank:r,file:i,x:o,y:l}=e,u=n.endsWith("p");return u?A({position:t,piece:n,rank:r,file:i,x:o,y:l}):g({position:t,piece:n,rank:r,file:i,x:o,y:l})},isPlayerChecked:function(e){let{positionAfterMove:t,position:n,player:r}=e,i=r.startsWith("w")?"b":"w",o=k(t,r),l=b(t,i),u=l.reduce((e,r)=>e=[...e,...r.piece.endsWith("p")?f({position:t,prevPosition:n,...r}):this.getRegularMove({position:t,...r})],[]);return!!u.some(e=>{let[t,n]=e;return o[0]===t&&o[1]===n})},isStalemate:function(e,t,n){let r=this.isPlayerChecked({positionAfterMove:e,player:t});if(r)return!1;let i=b(e,t),o=i.reduce((t,r)=>t=[...t,...this.getValidMoves({position:e,castleDirection:n,...r})],[]);return!r&&0===o.length},insufficientMaterial:function(e){let t=e.reduce((e,t)=>e=[...e,...t.filter(e=>e)],[]);return!!(2===t.length||3===t.length&&t.some(e=>e.endsWith("b")||e.endsWith("n"))||4===t.length&&t.every(e=>e.endsWith("b")||e.endsWith("k"))&&4===new Set(t).size&&(0,u.gJ)((0,u.FC)(e,"wb")[0],(0,u.FC)(e,"bb")[0]))},isCheckMate:function(e,t,n){let r=this.isPlayerChecked({positionAfterMove:e,player:t});if(!r)return!1;let i=b(e,t),o=i.reduce((t,r)=>t=[...t,...this.getValidMoves({position:e,castleDirection:n,...r})],[]);return console.log(r&&0===o.length),r&&0===o.length}};var m=n(8667),M=function(e){let{file:t,rank:n,piece:i}=e,{appState:u,dispatch:s}=(0,o.b)(),a=u.position[u.position.length-1],c=()=>{if(u.opponent!==i[0]&&u.turn===i[0]&&u.status!==l.XN.gameEnd){s((0,m.wc)());let e=C.getValidMoves({position:a,prevPosition:u.position[u.position.length-2],castelDirection:u.castlingdir[u.turn],rank:n,file:t,piece:i,opponent:u.opponent});s((0,m.ut)({pieces_square_info:"".concat(i,",").concat(n,",").concat(t)})),s((0,m.$j)({candicateMove:e}))}};return(0,r.jsx)("div",{className:"piece ".concat(i," p-").concat(u.opponent).concat(t).concat(n),onClick:e=>{c()}})},N=function(){let{appState:e,dispatch:t}=(0,o.b)(),n=e.position[e.position.length-1],l=(0,i.useRef)(),s=t=>{let{top:n,left:r,width:i}=l.current.getBoundingClientRect(),o=i/8,u="b"===e.opponent?Math.floor((t.clientX-r)/o):7-Math.floor((t.clientX-r)/o),s="b"===e.opponent?7-Math.floor((t.clientY-n)/o):Math.floor((t.clientY-n)/o);return{x:s,y:u}},a=e=>{let{rank:n,file:r,x:i,y:o,piece:l}=e;t((0,m.YH)({rank:Number(n),file:Number(r),x:i,y:o,piece:l}))},c=n=>{let{piece:r,rank:i,file:o}=n,l=y({castelDirection:e.castlingdir,piece:r,rank:i,file:o});l&&t((0,m.tq)(l))},p=r=>{try{if(e.pieces_square_info){let{x:i,y:o}=s(r),[l,p,h]=e.pieces_square_info.split(",");if(e.candidateMove.find(e=>e[0]===i&&e[1]===o)){let r=l.startsWith("w")?"b":"w",s=e.castlingdir["".concat(l.startsWith("w")?"b":"w")];if("wp"===l&&7===i&&"b"===e.opponent||"bp"===l&&0===i&&"w"===e.opponent){a({rank:p,file:h,x:i,y:o});return}(l.endsWith("k")||l.endsWith("r"))&&c({piece:l,rank:p,file:h});let d=C.checkAmove({position:n,x:i,y:o,rank:p,file:h,piece:l}),f=(0,u.nq)({piece:l,rank:p,file:h,x:i,y:o,position:n});f.includes("x")&&t((0,m.Kt)({prevPosition:e.position[e.position.length-1],x:i,y:o}));let v=E({status:e.status,piece:l[1],prevSum:e.advantage,opponent:e.opponent,from_:"".concat(String.fromCharCode(97+Number(h))).concat(Number(p)+1),to_:"".concat(String.fromCharCode(97+o)).concat(i+1),x:i,y:o,prevPosition:e.position[e.position.length-1],promotion:null,opponentColor:e.opponent,moveColor:l[0],newMove:f});console.log(v,"advantages"),t((0,m.K1)(v)),t((0,m.Qc)({newPosition:d,newMove:f})),C.insufficientMaterial(d)?t((0,m.HE)()):C.isStalemate(d,r,s)?t((0,m.ib)()):C.isCheckMate(d,r,s)&&t((0,m.Qu)(l[0]))}t((0,m.UG)()),t((0,m.wc)())}}catch(e){console.log(e,"error Occored")}};return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:"pieces",ref:l,onClick:e=>{p(e)},onDrop:e=>{p(e)},onDragOver:e=>{e.preventDefault()},children:n.map((e,t)=>e.map((e,i)=>n[t][i]?(0,r.jsx)(M,{rank:t,file:i,piece:n[t][i]},t+"-"+i):null))})})},_=function(){let{appState:e}=(0,o.b)(),t=e.position[e.position.length-1];Array(8).fill().map((e,t)=>8-t),Array(8).fill().map((e,t)=>t+1);let n=(()=>{let n=C.isPlayerChecked({positionAfterMove:t,player:e.turn});return n?k(t,e.turn):null})(),i=(r,i)=>{let o="tile";return o+=(r+i)%2==0?" tile--dark ":" tile--light ",e.candidateMove.find(e=>e[0]===r&&e[1]===i)&&(t[r][i]?o+=" attacking":o+=" highlight"),n&&n[0]==r&&n[1]==i&&(o+=" checked"),o};return(0,r.jsxs)(r.Fragment,{children:[" ",(0,r.jsx)("div",{className:"tiles",children:t.map((e,t)=>e.map((e,n)=>(0,r.jsx)("div",{className:"".concat(i(7-t,n))},n+""+t)))}),(0,r.jsx)(N,{})]})}},6605:function(){}}]);